{% extends "base.html" %}

{% block title %}PhraseCraze - Register{% endblock %}

{% block navbar_items %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('view.index') }}"><i class="fa-solid fa-house"></i> Home</a>
    </li>
    
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fa-solid fa-check-to-slot"></i> Vote</a>
            {{ super() }}
    </li>

    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('view.leaderboards') }}"><i class="fa-solid fa-trophy"></i> Leaderboards</a>
    </li>
    
    {% if 'user' in session %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('view.profile') }}"><i class="fa-solid fa-gears"></i> Profile</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('auth.logout') }}"> <i class="fa-solid fa-right-to-bracket fa-rotate-180"></i> Logout</a>
    </li>
    {% else %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('auth.login') }}"><i class="fa-solid fa-right-to-bracket"></i> Login</a>
    </li>
    <li class="nav-item">
        <a class="nav-link active" href="{{ url_for('auth.register') }}"><i class="fa-solid fa-user-plus"></i> Register</a>
    </li>
    {% endif %}
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Register</h2>
    <form method="POST" action="{{ url_for('auth.register') }}">
        <div class="mb-3">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <label for="email" class="form-label">Email:</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Password:</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>

        <div class="strength-meter" id="strength-meter">
            <div class="strength-0"></div>
        </div>
        <p id="strength-text"></p>

        <button type="submit" class="btn phrasecraze-btn phrasecraze-btn-primary">Register</button>
    </form>

    <!-- Login with Google button -->
    <form method="POST" action="{{ url_for('auth.login_provider', provider='google') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <button class="btn phrasecraze-btn phrasecraze-btn-google mt-2" href=""><i class="fa-brands fa-google"></i> Register with Google</button>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js" integrity="sha512-TZlMGFY9xKj38t/5m2FzJ+RM/aD5alMHDe26p0mYUMoCF5G7ibfHUQILq0qQPV3wlsnCwL+TPRNK4vIWGLOkUQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script nonce="{{ csp_nonce() }}">
    const passwordInput = document.getElementById('password');
    const strengthMeter = document.getElementById('strength-meter');
    const strengthText = document.getElementById('strength-text');

    const detailedSuggestions = {
        "Add another word or two. Uncommon words are better.": "Aim for 3-4 words. The more unusual the combination, the better. 'purple-octopus-glasses' is far stronger than 'password123'.",
        "Use a few words, avoid common phrases": "Combine unrelated words to create a unique password. Instead of 'iloveyou' or 'password123', try 'dancing-banana-moonlight'. This is much harder for hackers to guess, as it's not based on common phrases or patterns.",
        "Avoid sequences": "Avoid obvious sequences like '123456', 'abcdef', or repeated characters like 'aaaaaa'. Mix things up with random numbers and letters.",
        "Avoid recent years": "Hackers often try recent years, so avoid using '2024', '2023', or other easily guessable dates.",
        "Avoid years that are associated with you": "Birth years or anniversary dates are prime targets for hackers. Avoid using years that are personally significant to you.",
        "Avoid dates and years that are associated with you": "Significant dates, like birthdays or memorable events, should not be included in your password. Hackers can easily find this information online.",
        "Avoid common names and surnames": "Your name, family names, or common surnames are easy to guess.  Instead, use a combination of unrelated words or characters that don't reveal personal information.",
        "Predictable substitutions like '@' instead of 'a' don't help very much": "Swapping letters for symbols (e.g., '@' for 'a') is a common trick, but hackers know it. Instead, focus on creating a longer, more complex password with a variety of characters.",
        "Capitalization doesn't help very much": "While using capital letters can add some complexity, it's not enough on its own. Combine capitalization with other strategies like longer passphrases, random characters, and numbers to make your password truly strong.",
        "Reversed words aren't much harder to guess":  "Simply reversing a word ('password' to 'drowssap') doesn't make it significantly harder to crack. Focus on creating a more complex password with a combination of techniques.",
        "Add some numbers": "Numbers are an important element of strong passwords. Include a mix of numbers throughout your passphrase or word combination, making it even harder to guess.",
        "Add some symbols": "Adding symbols to your password increases its complexity and makes it more difficult to crack. Aim for a few special characters mixed in with your letters and numbers.",
        "Use a longer keyboard pattern with more turns": "Avoid simple horizontal or vertical lines. Instead, try a zigzag, a spiral, or a random pattern across the keyboard."
    };

    passwordInput.addEventListener('input', function() {
        const password = passwordInput.value;

        if (password === '') {
            strengthMeter.firstElementChild.className = 'strength-0';
            strengthMeter.firstElementChild.style.width = '0%';
            strengthText.textContent = '';
            return;
        }

        const result = zxcvbn(password);
        const score = result.score;
        const feedbackSuggestions = result.feedback.suggestions.map(suggestion => detailedSuggestions[suggestion] || suggestion);
        const feedback = feedbackSuggestions.join(' ');
        
        const meterClasses = ['strength-0', 'strength-1', 'strength-2', 'strength-3', 'strength-4'];
        const meterWidths = ['25%', '50%', '75%', '100%', '100%'];
        strengthMeter.firstElementChild.className = meterClasses[score];
        strengthMeter.firstElementChild.style.width = meterWidths[score];
        
        strengthText.textContent = `Password Strength: ${['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'][score]}`;
        if (feedback) {
            strengthText.textContent += `. Suggestions: ${feedback}`;
        }
    });
</script>
{% endblock %}