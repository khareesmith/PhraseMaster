{% extends "base.html" %}

{% block title %}Login - Phrase Craze{% endblock %}

{% block navbar_items %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('view.index') }}"><i class="fa-solid fa-house"></i> Home</a>
    </li>
    
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fa-solid fa-check-to-slot"></i> Vote</a>
            {{ super() }}
    </li>
    
    {% if 'user' in session %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('view.profile') }}"><i class="fa-solid fa-gears"></i> Profile</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('auth.logout') }}"> <i class="fa-solid fa-right-to-bracket fa-rotate-180"></i> Logout</a>
    </li>
    {% else %}
    <li class="nav-item">
        <a class="nav-link active" href="{{ url_for('auth.login') }}"><i class="fa-solid fa-right-to-bracket"></i> Login</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('auth.register') }}"><i class="fa-solid fa-user-plus"></i> Register</a>
    </li>
    {% endif %}
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Login</h2>
    <form method="POST" action="{{ url_for('auth.login') }}">
        <div class="mb-3">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <label for="email" class="form-label">Email address</label>
            <input type="email" class="form-control" id="email" name="email" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <button type="submit" class="btn phrasecraze-btn phrasecraze-btn-primary"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
    </form>

    <!-- Login with Google button -->
    <form method="POST" action="{{ url_for('auth.login_provider', provider='google') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <button class="btn phrasecraze-btn phrasecraze-btn-google mt-2" href=""><i class="fa-brands fa-google"></i> Login with Google</button>
    </form>

    <!-- Password reset button -->
    <form method="GET" action="{{ url_for('auth.reset_password_request') }}">
        <button class="btn phrasecraze-btn phrasecraze-btn-sm mt-4"><i class="fa-solid fa-key"></i> Password Reset</button>
    </form>

    {% if unverified %}
    <div class="mt-3">
        <p>Didn't receive the verification email? 
            <a href="{{ url_for('auth.resend_verification') }}" id="resend-link">
                Resend verification
            </a>
        </p>
        <form id="resend-form" method="POST" action="{{ url_for('auth.resend_verification') }}" style="display: none;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        </form>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{% if unverified %}
<script nonce="{{ csp_nonce() }}">
document.getElementById('resend-link').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('resend-form').submit();
});
</script>
{% endif %}
{% endblock %}