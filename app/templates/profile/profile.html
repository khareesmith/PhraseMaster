{% extends "base.html" %}

{% block title %}User Profile - Phrase Craze{% endblock %}

{% block nav_profile_active %}active{% endblock %}

{% block user_welcome %}
<span class="navbar-text ms-3" id="username">
    {{ session['user']['name'] }}
</span>
{% endblock %}

{% block navbar_items %}
<li class="nav-item">
    <a class="nav-link" href="{{ url_for('view.index') }}"><i class="fa-solid fa-house"></i> Home</a>
</li>

{% if 'user' in session and session['user'].get('is_admin') %}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('admin.admin_dashboard') }}"><i class="fa-solid fa-user-tie"></i> Admin Dashboard</a>
    </li>
{% endif %}

<li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fa-solid fa-check-to-slot"></i> Vote</a>
    {{ super() }}
</li>
<li class="nav-item">
    <a class="nav-link active" href="{{ url_for('view.profile') }}"><i class="fa-solid fa-gears"></i> Profile</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="{{ url_for('auth.logout') }}"> <i class="fa-solid fa-right-to-bracket fa-rotate-180"></i> Logout</a>
</li>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="profile-card">
                <h1 class="text-center mb-4">{{ user.name }}'s Profile</h1>
                
                <div class="row">
                    <div class="col-md-6 profile-section">
                        <h3>User Info</h3>
                        <p><strong>Email:</strong> {{ user.email }}</p>
                        <p><strong>Username:</strong> {{ user.name }}</p>
                    </div>
                    <div class="col-md-6 profile-section">
                        <h3>Streaks</h3>
                        <div class="streak-info">
                            <span class="streak-label">Login Streak:</span>
                            <span class="streak-value">{{ streaks.login }} days</span>
                        </div>
                        <div class="streak-info">
                            <span class="streak-label">Submission Streak:</span>
                            <span class="streak-value">{{ streaks.submission }} days</span>
                        </div>
                        <div class="streak-info">
                            <span class="streak-label">Voting Streak:</span>
                            <span class="streak-value">{{ streaks.voting }} days</span>
                        </div>
                    </div>
                </div>

                {% if best_submission %}
                <div class="profile-section">
                    <h3>Best Submission</h3>
                    <div class="best-submission">
                        <h5>{{ best_submission.category|replace('_', ' ')|title }}</h5>
                        <p><strong>Prompt:</strong> {{ best_submission.challenge }}</p>
                        <p><strong>Your Phrase:</strong> {{ best_submission.user_phrase }}</p>
                        <p><strong>Votes:</strong> {{ best_submission.votes }}</p>
                        <p><small class="text-muted">Submitted on {{ best_submission.date }}</small></p>
                    </div>
                </div>
                {% endif %}

                <div class="text-center mt-4">
                    <a class="btn phrasecraze-btn phrasecraze-btn-primary" href="{{ url_for('auth.choose_username') }}">Change Username</a>
                    <a class="btn phrasecraze-btn phrasecraze-btn-secondary" href="{{ url_for('auth.change_password') }}">Change Password</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}